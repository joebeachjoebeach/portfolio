<!DOCTYPE html>
<html>
<head>
<meta name="description" content="Boss Fight">
<script src="https://cdn.rawgit.com/stevekrouse/WoofJS/7c5bc09cb9ec5b1e799111bb92842f1c7acce2b5/woof.js"></script>
<script type="text/javascript" src="js/boss-fight.js"></script>
<link rel="icon" href="../media/favicon.ico">
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Boss Fight!</title>
</head>
<body>
<script>
// Boss Fight

setBackdropColor("#050014");

var playBox = new Rectangle({
	color: "#50AA55",
	width: 125,
	height: 35,
	y: 5,
	showing: true,
});

var playText = new Text({
	text: "Click to Play",
	size: 18,
	color: "#FFF",
	fontFamily: "verdana",
	textAlign: "center",
	showing: true,
});

var player1 = new Rectangle({
	color: "#CC3700",
	width: 45,
	y: minY + 20,
	showing: false,
});

var player2 = new Rectangle({
	color: "#CC3700",
	width: 30,
	y: minY + 26,
	showing: false,
});

var player3 = new Rectangle({
	color: "#CC3700",
	width: 15,
	y: minY + 32,
	showing: false,
});

var player = [player1, player2, player3];

var playerHPNumber = 500;

var playerHP = new Text({
	color: "#FFF",
	size: 16,
	text: () => "Player HP: " + playerHPNumber,
	textAlign: "right",
	x: maxX - 10,
	y: maxY - 18,
	showing: false,
});

var bossHead = new Rectangle({
	color: "#E6AF2E",
	width: 150,
	height: 100,
	y: maxY - 130,
	showing: false,
});

var bossLeftEye = new Rectangle({
	color: "#38040E",
	width: 30,
	height: 25,
	y: maxY - 145,
	x: -35,
	showing: false,
})

var bossRightEye = new Rectangle({
	color: "#38040E",
	width: 30,
	height: 25,
	y: maxY - 145,
	x: 35,
	showing: false,
})

var bossMouth = new Rectangle({
	color: "#38040E",
	width: 30,
	height: 5,
	y: maxY - 173,
	showing: false,
})

var bossRightEyebrow = new Rectangle({
	color: "#38040E",
	width: 40,
	height: 5,
	y: maxY - 122,
	x: 32,
	angle: 25,
	showing: false
})

var bossLeftEyebrow = new Rectangle({
	color: "#38040E",
	width: 40,
	height: 5,
	y: maxY - 122,
	x: -32,
	angle: -25,
	showing: false,
})

var boss = [bossHead, bossLeftEye, bossRightEye, bossMouth, bossRightEyebrow, bossLeftEyebrow];

var bossBomb = new Circle({
	color: "#4B3F72",
	radius: 26,
	showing: false,
	y: maxY - 180,
})

var bossHPNumber = 2500;

var bossHP = new Text({
	color: "#FFF",
	size: 16,
	text: () => "Boss HP: " + bossHPNumber,
	textAlign: "left",
	x: minX + 10,
	y: maxY - 18,
	showing: false,
});

var bossMovement = random(2, 4);

var laser = [];

var bombNumber = 5;

var bombs = new Text({
	text: () => "Bombs: " + bombNumber,
	color: "#FFF",
	size: 16,
	textAlign: "right",
	x: maxX - 10,
	y: maxY - 36,
	showing: false,
})

var youWin = new Text({
	text: "YOU WIN!",
	color: "#FFF",
	size: 24,
	showing: false,
});

var pressA = new Text({
	text: "press 'a' to play again",
	color: "#FFF",
	size: 20,
	y: -40,
	showing: false,
})

var gameOverText = new Text({
	text: "GAME OVER!",
	color: "#FFF",
	size: 24,
	showing: false,
});

var playerBomb = false;

var bossLaser = [];

var bossSpray = [];

var holdLaser = false;

var gameOver = false;

playBox.onMouseDown(() => {
	
	playBox.showing = false;
	playText.showing = false;
	player.forEach(part => {
		part.showing = true;
	});
	boss.forEach(part => {
		part.showing = true;
	});
	bossHP.showing = true;
	playerHP.showing = true;
	bombs.showing = true;
	
	forever(() => {
		
		//movement and boundaries
		player.forEach(part => {
			
			if (keysDown.includes("LEFT")) {
				part.x -= 5;
			};
			
			if (keysDown.includes("RIGHT")) {
				part.x += 5;
			};
			
			if (keysDown.includes("UP")) {
				part.y += 5;
			};
			
			if (keysDown.includes("DOWN")) {
				part.y -= 5;
			};
			
			if (part.x <= minX) {
				part.x = minX;
			};
			
			if (part.x >= maxX) {
				part.x = maxX;
			};
			
			if (player[0].y <= minY) {
				part.y = minY + (6 * player.indexOf(part));
			};
			
			if (player[0].y >= maxY) {
				part.y = maxY + (6 * player.indexOf(part));
			};
			
			//die if you touch the boss
			if (part.touching(boss[0])) {
				playerHPNumber -= 500;
			};
			
		})

		//laser movement and damage
		laser.forEach(clone => {
			clone.y += 3;
			if (clone.y > maxY + 15) {
				clone.delete();
			};
			if (clone.touching(boss[0])) {
				clone.delete();
				bossHPNumber -= 5;
			};
		});
		
		//laser limiting
		if (!keysDown.includes("SPACE")) {
			holdLaser = false;
		};
		
		//player bomb
		if (playerBomb) {
			bossBomb.showing = false;
			bossLaser.forEach(laser => {
				laser.delete();
			})
			bossSpray.forEach(dot => {
				dot.delete();
			})
			playerBomb = false;
		}
		
		
		//boss movement
		boss.forEach(part => {
			part.x += bossMovement;
		});
		
		//boss right boundary
		if (boss[0].x > maxX - 70) {
			bossMovement = random(-4, -2);
		};
		
		//boss left boundary
		if (boss[0].x < minX + 70) {
			bossMovement = random(2, 4);
		};
		
		//boss laser movement
		bossLaser.forEach(clone => {
			clone.y -= 4;
			if (clone.y < minY + 17) {
				clone.delete();
			}
			if (clone.touching(player[0])) {
				clone.delete();
				playerHPNumber -= 7;
			};
		})
		
		//boss bomb movement
		bossBomb.y -= 10;
		
		//boss spray movement and damage
		bossSpray.forEach(dot => {
			dot.move(2);
			if (dot.y < minY) {
				dot.delete();
			}
			if (player.some(part => part.touching(dot))) {
				dot.delete();
				playerHPNumber -= 25;
			}
		})
		
		//boss bomb boundary
		if (bossBomb.y < minX - 13) {
			bossBomb.showing = false;
		};
		
		//boss bomb damage
		if (player.some(part => part.touching(bossBomb))) {
			bossBomb.showing = false;
			playerHPNumber -= 100;
		};
		
		//game over
		if (playerHPNumber <= 0) {
			playerHPNumber = 0;
			gameOver = true;
			player.forEach(part => {
				part.showing = false;
			});
			gameOverText.showing = true;
			pressA.showing = true;
			freeze();
		};
		
		//you win
		if (bossHPNumber <= 0) {
			bossHPNumber = 0;
			gameOver = true;
			bossSpray.forEach(part => {
				part.delete();
			});
			bossLaser.forEach(part => {
				part.delete();
			});
			bossBomb.showing = false;
			youWin.showing = true;
			pressA.showing = true;
			freeze();
		};
		
	});
	
	//boss lasers
	every(1.5, "seconds", () => {
		var reps = random(2, 20);
		repeat(reps, () => {
			var newLaser = new Rectangle({
				color: "#4B3F72",
				height: 50,
				width: 5,
				x: boss[0].x,
				y: maxY -190,
			});
			bossLaser.push(newLaser);
		});
	});
	
	//boss bombs
	every(2, "seconds", () => {
		if (laser.length > 0) {
			bossBomb.x = boss[0].x;
			bossBomb.y = maxY - 180;
			bossBomb.showing = true;
		};
	})
	
	//boss bomb color changing
	every(0.1, "seconds", () => {
		
		if (bossBomb.color == "#4B3F72") {
			bossBomb.color = "#E7AC41";
		}
		else if (bossBomb.color == "#E7AC41") {
			bossBomb.color = "#4B3F72";
		};
	})
	
	//boss spray and opening mouth
	every(7, "seconds", () => {
		if (laser.length > 0) {
			var angle = -135;
			repeat(50, () => {
				var newDot = new Rectangle({
					color: "#8D99AE",
					height: 4,
					width: 4,
					x: boss[0].x,
					y: maxY - 180,
					angle: angle,
				})
				bossSpray.push(newDot);
				angle += 1.2;
				boss[3].height += 0.25;
			}, () => {
				repeat(25, () => {
					boss[3].height -= 0.5;
				})
			})
		}
	})	
});

//show instructions and disappear them after 4 seconds
playBox.onMouseDown(() => {
	var instructions = new Text({
		text: "press 'space' to fire -- press 'b' for bomb",
		color: "#FFF",
		size: 14,
	})
	after(4, "seconds", () => {
		instructions.showing = false;
	})
})

//laser shooting -- only shoots in bursts of 6
onKeyDown(key => {
	if (key == "SPACE" && !holdLaser) {
		repeat(6, () => {
			var newLaser = new Rectangle({
				color: "#0095CC",
				height: 30,
				width: 5,
				x: player[0].x,
				y: player[2].y + 20,
			});
			laser.push(newLaser);
		});
	};
});

//makes it impossible to hold down SPACE for continuous laser
onKeyDown(key => {
	if (key == "SPACE") {
		after(1, "seconds", () => {
			holdLaser = true;
		});
	};
});

//player bomb to wipe the screen
onKeyDown(key => {
	if (key == "B" && bombNumber > 0) {
		playerBomb = true;
		bombNumber--;
		setBackdropColor("#FFFFCC");
		after(0.1, "seconds", () => {
			setBackdropColor("#050014");
		});
	};
})

//restarting the game
onKeyDown(key => {
	if (key == "A" && gameOver) {
		laser.forEach(part => {
			part.delete();
		});
		laser = [];
		bossBomb.showing = false;
		bossSpray.forEach(dot => {
			dot.delete();
		});
		bossSpray = [];
		bossLaser.forEach(part => {
			part.delete();
		});
		bossLaser = [];
		player.forEach(part => {
			part.x = 0;
			part.y = 20 + minY + (6 * player.indexOf(part)); 
			part.showing = true;
		});
		gameOverText.showing = false;
		youWin.showing = false;
		pressA.showing = false;
		playerHPNumber = 500;
		bossHPNumber = 2500;
		defrost();
	};
})


</script>
</body>
</html>