<!DOCTYPE html>
<html>
<head>
<meta name="description" content="Flappy Dot">
<script src="https://cdn.rawgit.com/stevekrouse/WoofJS/7c5bc09cb9ec5b1e799111bb92842f1c7acce2b5/woof.js"></script>
<script type="text/javascript" src="js/flappy-dot.js"></script>
<link rel="icon" href="../media/favicon.ico">
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Flappy Dot</title>
</head>
<body>
<script>
// Flappy Dot

setBackdropColor("#0AF");

var playBox = new Rectangle({
	color: "#50AA55",
	width: 125,
	height: 35,
	y: 5,
	showing: true,
});

var playText = new Text({
	text: "Click to Play",
	size: 18,
	color: "#FFF",
	fontFamily: "verdana",
	textAlign: "center",
	showing: true,
});

var bird = new Circle({
	color: "#FF6",
	radius: 18,
	showing: false,
});

var pipes = [];

var scoreNumber = 0;

var score = new Text({
	color: "#FFF",
	size: 16,
	text: () => "Score: " + scoreNumber,
	textAlign: "left",
	x: minX + 10,
	y: maxY - 20,
	showing: false,
});

var instructions = new Text({
	color: "#FFF",
	size: 16,
	text: "Click to stay up!",
	showing: false,
})

var pressSpace = new Text({
	color: "#FFF",
	size: 16,
	x: minX + 150,
	y: maxY - 50,
	text: "Game Over! Press SPACE to play again!",
	showing: false,
})

var gameOver = false;

var speed = 4;

//make mouseDown usable in an if statement instead of just an event
var mouseDown = 0;
onMouseDown(() => {
	mouseDown ++;
});
onMouseUp(() => {
	mouseDown--;
});

playBox.onMouseDown(() => {
	
	playBox.showing = false;
	playText.showing = false;
	instructions.showing = true;
	score.showing = true;
	bird.showing = true;
	
	after(2, "seconds", () => {
		instructions.showing = false;
	})
	
	forever(() => {
		
		//make the bird fall and accelerate
		bird.y -= speed;
		speed += 0.5;
		
		//make the bird rise on click
		if (mouseDown) {
				repeat (7, () => {
					bird.y += 2;
				})
			//reset the falling speed	
			speed = 4;
		};
		
		//end the game if the bird falls, goes too high, or touches a pipe
		if (bird.y < minY - 3 || bird.y > maxY + 3 || pipes.some(pipe => pipe.touching(bird))) {
			pressSpace.showing = true;
			pipes.forEach(pipe => {
				pipe.delete();
			});
			freeze();
			gameOver = true;
		};
		
		pipes.forEach(pipe => {
			
			//move the pipes
			pipe.x -= 3;
			
			//delete off-screen pipes
			if (pipe.x < minX - 25) {
				pipe.delete();
			};
			
			//scoring
			if (pipe.x < -32 && pipe.x > -36) {
				scoreNumber += 0.5;
			};
			
		});
	});	
	
	//pipe spawning
	every (3, "seconds", () => {
		var gapPosition = random(minY + 200, maxY - 200);
		var topPipe = new Rectangle({
			color: "#0E0",
			height: 700,
			width: 50,
			y: gapPosition + 410,
			x: maxX + 25,
		});
		var bottomPipe = new Rectangle({
			color: "#0E0",
			height: 700,
			width: 50,
			y: gapPosition - 410,
			x: maxX + 25,
		});
		pipes.push(topPipe);
		pipes.push(bottomPipe);
	})	
})


//restart the game with SPACE only if the game is over
onKeyDown(key => {
	if (key == "SPACE" && gameOver) {
		pipes.forEach(clone => {
			clone.delete();
		});
		bird.x = 0;
		bird.y = 0;
		speed = 4;
		gameOver = false;
		scoreNumber = 0;
		pipes = [];
		pressSpace.showing = false;
		defrost();
	};
})



</script>
</body>
</html>