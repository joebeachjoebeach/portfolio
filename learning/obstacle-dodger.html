<!DOCTYPE html>
<html>
<head>
<meta name="description" content="Obstacle Dodger">
<script src="https://cdn.rawgit.com/stevekrouse/WoofJS/7c5bc09cb9ec5b1e799111bb92842f1c7acce2b5/woof.js"></script>
<script type="text/javascript" src="js/obstacle-dodger.js"></script>
<link rel="icon" href="../media/favicon.ico">
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Obstacle Dodger</title>
</head>
<body>
<script>
// Obstacle Dodger


//spawn the squares at a random spot on the edge
function randomXYEdge() {
	var x = 0;
	var y = 0;
	var side = random(1, 4);
	if (side === 1) { //top
		x = randomX();
		y = maxY;
	}
	else if (side === 2) { //right
		x = maxX;
		y = randomY();
	}
	else if (side === 3) { //bottom
		x = randomX();
		y = minY;
	}
	else if (side === 4) { //left 
		x = minX;
		y = randomY();
	}
	return [x, y];
};

setBackdropColor("#556");

var playBox = new Rectangle({
	color: "#50AA55",
	width: 125,
	height: 35,
	y: 5,
	showing: true,
});

var playText = new Text({
	text: "Click to Play",
	size: 18,
	color: "#FFF",
	fontFamily: "verdana",
	textAlign: "center",
	showing: true,
});

var outerCircle = new Circle({
	color: "#5A5",
	radius: 17,
	showing: false,
});

var innerCircle = new Circle({
	color: "#556",
	showing: false,
});

//group the circles into an array to use forEach() on them to change X and Y etc.
var player = [outerCircle, innerCircle];

var squareClones = [];

var timerNumber = -1;

var timer = new Text({
	color: "#FFF",
	text: () => "Time: " + timerNumber,
	textAlign: "left",
	x: minX + 3,
	y: maxY - 12,
	showing: false,
})

var instructions = new Text({
	color: "#FFF",
	text: "Use Arrow Keys to Move",
	showing: false,
})

var pressSpace = new Text({
	color: "#FFF",
	text: "Press Space to Play Again",
	showing: false,
})

var gameOver = false;



playBox.onMouseDown(() => {
	
	playBox.showing = false;
	playText.showing = false;
	instructions.showing = true;
	timer.showing = true;
	player.forEach(circle => {
		circle.showing = true;
	});
	
	after(3, "seconds", () => {
		instructions.showing = false;
	});
	
	//countdown timer and square spawning
	every(1, "seconds", () => {
		timerNumber++;
		var xy = randomXYEdge();
		var clone = new Rectangle({
			color: "#333",
			width: 6,
			height: 6,
			x: xy[0],
			y: xy[1],
		});
		squareClones.push(clone);
	});
	
	forever(() => {
		
		//movement
		if (keysDown.includes("LEFT")) {
			player.forEach(circle => {
				circle.x -= 10;
			})
		};
	
		if (keysDown.includes("RIGHT")) {
			player.forEach(circle => {
				circle.x += 10;
			})
		};
	
		if (keysDown.includes("UP")) {
			player.forEach(circle => {
				circle.y += 10;
			})
		};
	
		if (keysDown.includes("DOWN")) {
			player.forEach(circle => {
				circle.y -= 10;
			})
		};
	
		//keeping the circle within bounds
		if (outerCircle.y > maxY) {
			player.forEach(circle => {
				circle.y = maxY;
			})
		};
	
		if (outerCircle.y < minY) {
			player.forEach(circle => {
				circle.y = minY;
			})
		};
	
		if (outerCircle.x > maxX) {
			player.forEach(circle => {
				circle.x = maxX;
			})
		};
	
		if (outerCircle.x < minX) {
			player.forEach(circle => {
				circle.x = minX;
			})
		};
		
		//squares moving
		squareClones.forEach(clone => {
			clone.pointTowards(outerCircle.x, outerCircle.y);
			clone.move(2);
			
			//ending game on touch
			if (clone.touching(outerCircle)) {
				pressSpace.showing = true;
				freeze();
				gameOver = true;
			}
		})
	});
});

//restart the game on SPACE only if the game is over
onKeyDown(key => {
	if (key == "SPACE" && gameOver) {
		timerNumber = 0;
		gameOver = false;
		squareClones.forEach(clone => {
			clone.delete();
		});
		player.forEach(circle => {
			circle.x = 0;
			circle.y = 0;
		})
		pressSpace.showing = false;
		defrost();
	}
})

</script>
</body>
</html>